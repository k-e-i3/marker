<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ»ãƒãƒ¼ã‚«ãƒ¼å¼æš—è¨˜ãƒ„ãƒ¼ãƒ« v2.2</title>
    <style>
        :root {
            --bg-color: #f4f4f9;
            --main-bg: #ffffff;
            --rule-bg: #eef1f5;
            --text-color: #333;
            --border-color: #d1d9e6;
            --header-bg: #3c4a6a;
            --header-text: #ffffff;
            --button-bg: #4a6fa5;
            --highlight-bg: #fffde7;
            --speech-highlight-bg: #fdff32;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Hiragino Sans', 'Noto Sans CJK JP', sans-serif;
            margin: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }
        header {
            background-color: var(--header-bg);
            color: var(--header-text);
            padding: 10px 15px;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            flex-shrink: 0;
            z-index: 10;
        }
        header h1 {
            font-size: 1.1em;
            margin: 0;
        }
        .control-group {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        select, input, button {
            font-size: 14px;
            padding: 5px 10px;
            border-radius: 4px;
            border: 1px solid var(--border-color);
            background-color: #f0f8ff;
        }
        button {
            background-color: var(--button-bg);
            color: var(--header-text);
            cursor: pointer;
            border-color: transparent;
            transition: background-color 0.2s;
        }
        button:hover {
            background-color: #5a85c8;
        }
        main {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            padding: 15px;
            gap: 15px;
            overflow: hidden;
            position: relative;
        }
        .panel {
            background-color: var(--main-bg);
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .panel.main { flex-grow: 1; }
        .panel.rules { flex-shrink: 0; height: 150px; transition: height 0.3s ease; }
        .panel.rules.closed { height: 40px; }
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            border-bottom: 1px solid var(--border-color);
            background-color: #f9fafb;
            cursor: pointer;
        }
        .panel-header h2 { font-size: 1em; margin: 0; }
        textarea, #main-text-area {
            flex-grow: 1;
            border: none;
            padding: 15px;
            font-size: 18px;
            line-height: 1.8;
            resize: none;
            outline: none;
            background-color: transparent;
            font-family: inherit;
        }
        #main-text-area { white-space: pre-wrap; word-wrap: break-word; overflow-y: auto; }
        #rules-text-area { background-color: var(--rule-bg); font-family: monospace; font-size: 13px; line-height: 1.6; }
        .marker { cursor: pointer; border-radius: 3px; user-select: none; letter-spacing: 0.05em; }
        .marker.reveal { background-color: var(--highlight-bg); letter-spacing: normal; }
        .speech-highlight { background-color: var(--speech-highlight-bg); border-radius: 3px; }
        
        #mini-palette {
            position: absolute;
            background-color: #333;
            padding: 8px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            display: none;
            gap: 5px;
            z-index: 100;
        }
        .mini-palette-item {
            width: 32px; height: 32px; cursor: pointer; border: 2px solid transparent; border-radius: 6px;
            display: flex; justify-content: center; align-items: center; font-size: 22px; transition: transform 0.1s;
        }
        .mini-palette-item:hover { transform: scale(1.15); background-color: #555; }
        
        #modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.6); z-index: 1000;
            display: none; justify-content: center; align-items: center;
        }
        .modal-content {
            background-color: #fff; padding: 20px; border-radius: 8px;
            width: 80%; max-width: 600px; display: flex;
            flex-direction: column; gap: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .modal-content textarea { height: 40vh; border: 1px solid #ccc; }
        .modal-buttons { display: flex; gap: 10px; justify-content: flex-end; }
    </style>
</head>
<body>
    <header>
        <h1>ãƒãƒ¼ã‚«ãƒ¼å¼æš—è¨˜ãƒ„ãƒ¼ãƒ« v2.2</h1>
        <div class="control-group">
            <select id="doc-select"></select>
            <button id="rename-doc-btn">ğŸ“</button>
        </div>
        <div class="control-group">
            <button id="speech-btn">â–¶ èª­ã¿ä¸Šã’</button>
            <select id="voice-select"></select>
        </div>
        <div class="control-group">
            <button id="import-export-btn">ğŸ“¥ğŸ“¤ ãƒ‡ãƒ¼ã‚¿åŒæœŸ</button>
        </div>
    </header>

    <main>
        <div id="mini-palette"></div>
        <div class="panel main">
            <div id="main-text-area" contenteditable="true" spellcheck="false"></div>
        </div>
        <div class="panel rules" id="rules-panel">
            <div class="panel-header" id="rules-header">
                <h2>ãƒãƒ¼ã‚«ãƒ¼ã®ãƒ«ãƒ¼ãƒ« (è‡ªå‹•ç”Ÿæˆ)</h2>
                <span id="toggle-rules-btn">â–¼ é–‰ã˜ã‚‹</span>
            </div>
            <textarea id="rules-text-area" readonly></textarea>
        </div>
    </main>
    
    <div id="modal-overlay">
        <div class="modal-content" id="io-modal">
            <h3 id="modal-title">ãƒ‡ãƒ¼ã‚¿ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</h3>
            <p id="modal-desc">ä»¥ä¸‹ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¨ã¦ã‚³ãƒ”ãƒ¼ã—ã€ä»–ã®ãƒ‡ãƒã‚¤ã‚¹ã§ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ãã ã•ã„ã€‚</p>
            <textarea id="io-textarea"></textarea>
            <div class="modal-buttons">
                <button id="copy-io-btn">ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼</button>
                <button id="close-modal-btn">é–‰ã˜ã‚‹</button>
            </div>
        </div>
    </div>

    <script>
    class MarkerToolV2_2 {
        constructor() {
            // DOM
            this.docSelect = document.getElementById('doc-select');
            this.renameDocBtn = document.getElementById('rename-doc-btn');
            this.mainTextArea = document.getElementById('main-text-area');
            this.rulesTextArea = document.getElementById('rules-text-area');
            this.speechBtn = document.getElementById('speech-btn');
            this.voiceSelect = document.getElementById('voice-select');
            this.rulesPanel = document.getElementById('rules-panel');
            this.rulesHeader = document.getElementById('rules-header');
            this.toggleRulesBtn = document.getElementById('toggle-rules-btn');
            this.miniPalette = document.getElementById('mini-palette');
            this.modalOverlay = document.getElementById('modal-overlay');
            this.modalTitle = document.getElementById('modal-title');
            this.modalDesc = document.getElementById('modal-desc');
            this.ioTextarea = document.getElementById('io-textarea');
            this.copyIoBtn = document.getElementById('copy-io-btn');
            this.closeModalBtn = document.getElementById('close-modal-btn');
            this.importExportBtn = document.getElementById('import-export-btn');

            // ãƒ‘ãƒ¬ãƒƒãƒˆ
            this.markerStyles = [
                { type: 'E', value: 'gray', display: 'â¬œ' },
                { type: 'E', value: 'ğŸ' }, { type: 'E', value: 'ğŸ™' },
                { type: 'E', value: 'ğŸ˜€' }, { type: 'E', value: 'ğŸ¸' },
                { type: 'E', value: 'ğŸ‘½' }, { type: 'E', value: 'ğŸ§Ÿâ€â™€ï¸' },
                { type: 'E', value: 'ğŸ¥¶' }, { type: 'E', value: 'ğŸŒ' },
                { type: 'E', value: 'ğŸ’©' }, { type: 'E', value: 'ğŸ‡' },
                { type: 'E', value: 'ğŸ€' }
            ];

            // çŠ¶æ…‹
            this.state = {
                anchorLength: 7,
                lastTap: 0,
                lastClickedMarker: null,
                isSpeaking: false,
                voices: [],
                appData: {
                    documents: [],
                    rules: ''
                },
                currentDocIndex: 0,
                selectionRange: null,
            };
            
            this.DOC_COUNT = 20;
            this.init();
        }

        init() {
            this.createMiniPalette();
            this.loadState();
            this.initSpeech();
            this.bindEvents();
            this.updateDocSelect();
            this.updateDocumentView();
        }

        bindEvents() {
            this.mainTextArea.addEventListener('mouseup', (e) => this.handleSelection(e));
            this.docSelect.addEventListener('change', (e) => this.switchDocument(parseInt(e.target.value, 10)));
            this.renameDocBtn.addEventListener('click', () => this.renameDocument());
            this.mainTextArea.addEventListener('click', (e) => this.handleMarkerClick(e));
            document.addEventListener('click', (e) => { // Hide mini palette on outside click
                if (!this.miniPalette.contains(e.target)) this.hideMiniPalette();
            });
            this.rulesHeader.addEventListener('click', () => this.toggleRulesPanel());
            this.speechBtn.addEventListener('click', () => this.toggleSpeech());
            this.importExportBtn.addEventListener('click', () => this.openExportModal());
            this.closeModalBtn.addEventListener('click', () => this.closeIoModal());
            this.copyIoBtn.addEventListener('click', () => this.handleIoAction());
        }

        createMiniPalette() {
            this.markerStyles.forEach(style => {
                const item = document.createElement('div');
                item.className = 'mini-palette-item';
                if (style.display) {
                    item.textContent = style.display;
                } else {
                    item.textContent = style.value;
                }
                item.addEventListener('mousedown', (e) => {
                    e.preventDefault();
                    this.createMarkerFromPalette(style);
                });
                this.miniPalette.appendChild(item);
            });
        }
        
        handleSelection(e) {
            const selection = window.getSelection();
            if (!selection.rangeCount || selection.isCollapsed || !selection.toString().trim()) {
                this.hideMiniPalette();
                return;
            }
            this.state.selectionRange = selection.getRangeAt(0).cloneRange();
            this.showMiniPalette(e.clientX, e.clientY);
        }

        showMiniPalette(x, y) {
            this.miniPalette.style.display = 'flex';
            this.miniPalette.style.left = `${x}px`;
            this.miniPalette.style.top = `${y - 60}px`;
        }
        
        hideMiniPalette() {
            this.miniPalette.style.display = 'none';
            this.state.selectionRange = null;
        }
        
        createMarkerFromPalette(style) {
            if (!this.state.selectionRange) return;

            const hiddenText = this.state.selectionRange.toString();
            const preRange = document.createRange();
            preRange.setStart(this.state.selectionRange.startContainer, 0);
            preRange.setEnd(this.state.selectionRange.startContainer, this.state.selectionRange.startOffset);
            const prefix = preRange.toString().slice(-this.state.anchorLength);

            const postRange = document.createRange();
            postRange.setStart(this.state.selectionRange.endContainer, this.state.selectionRange.endOffset);
            postRange.setEnd(this.state.selectionRange.endContainer, this.state.selectionRange.endContainer.length);
            const suffix = postRange.toString().slice(0, this.state.anchorLength);

            const styleString = `%% ${style.type}${style.value}`;
            const rule = `${this.state.currentDocIndex} :: ${prefix.trim()}...${suffix.trim()} -> ${hiddenText.trim()} ${styleString}`;
            
            const currentRules = this.state.appData.rules.split('\n').filter(Boolean);
            currentRules.push(rule);
            this.state.appData.rules = currentRules.join('\n');
            
            this.applyRules();
            this.hideMiniPalette();
            window.getSelection().removeAllRanges();
        }

        handleMarkerClick(e) { /* (v2.1ã‹ã‚‰å¤‰æ›´ãªã—) */ }
        removeMarker(markerElement) { /* (v2.1ã‹ã‚‰ä¸€éƒ¨ä¿®æ­£) */ }
        applyRules() { /* (v2.1ã‹ã‚‰ä¸€éƒ¨ä¿®æ­£) */ }
        
        // --- ãƒ‡ãƒ¼ã‚¿åŒæœŸ & ã‚¿ã‚¤ãƒˆãƒ«ç·¨é›† ---
        
        openExportModal() {
            this.modalTitle.textContent = "ãƒ‡ãƒ¼ã‚¿ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ";
            this.modalDesc.textContent = "ä»¥ä¸‹ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¨ã¦ã‚³ãƒ”ãƒ¼ã—ã€ä»–ã®ãƒ‡ãƒã‚¤ã‚¹ã§ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ãã ã•ã„ã€‚";
            this.ioTextarea.value = JSON.stringify(this.state.appData, null, 2);
            this.ioTextarea.readOnly = true;
            this.copyIoBtn.textContent = "ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼";
            this.modalOverlay.style.display = 'flex';
        }

        openImportModal() {
             this.modalTitle.textContent = "ãƒ‡ãƒ¼ã‚¿ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ";
             this.modalDesc.textContent = "ä»–ã®ãƒ‡ãƒã‚¤ã‚¹ã‹ã‚‰ã‚³ãƒ”ãƒ¼ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ã“ã“ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã¯ä¸Šæ›¸ãã•ã‚Œã¾ã™ã€‚";
             this.ioTextarea.value = '';
             this.ioTextarea.readOnly = false;
             this.copyIoBtn.textContent = "èª­ã¿è¾¼ã‚€";
             this.modalOverlay.style.display = 'flex';
        }
        
        closeIoModal() {
            this.modalOverlay.style.display = 'none';
        }
        
        handleIoAction() {
            if (this.copyIoBtn.textContent.includes('ã‚³ãƒ”ãƒ¼')) {
                navigator.clipboard.writeText(this.ioTextarea.value).then(() => {
                    this.copyIoBtn.textContent = "ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼";
                    setTimeout(() => this.copyIoBtn.textContent = "ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼", 2000);
                });
            } else { // Import
                try {
                    const newData = JSON.parse(this.ioTextarea.value);
                    if (newData.documents && typeof newData.rules === 'string') {
                        this.state.appData = newData;
                        this.state.currentDocIndex = 0; // Reset to first doc
                        this.saveState();
                        this.updateDocSelect();
                        this.updateDocumentView();
                        this.closeIoModal();
                    } else {
                        alert("ãƒ‡ãƒ¼ã‚¿ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚");
                    }
                } catch (e) {
                    alert("ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚å½¢å¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
                }
            }
        }
        
        renameDocument() {
            const currentTitle = this.state.appData.documents[this.state.currentDocIndex].title;
            const newTitle = prompt("æ–°ã—ã„ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:", currentTitle);
            if (newTitle && newTitle.trim()) {
                this.state.appData.documents[this.state.currentDocIndex].title = newTitle.trim();
                this.updateDocSelect();
                this.saveState();
            }
        }

        // --- çŠ¶æ…‹ç®¡ç† & UIæ›´æ–° ---

        updateDocSelect() {
            this.docSelect.innerHTML = '';
            this.state.appData.documents.forEach((doc, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = doc.title;
                this.docSelect.appendChild(option);
            });
            this.docSelect.value = this.state.currentDocIndex;
        }

        switchDocument(docIndex) {
            if (this.state.isSpeaking) this.toggleSpeech();
            this.state.appData.documents[this.state.currentDocIndex].content = this.getOriginalText();
            this.state.currentDocIndex = docIndex;
            this.updateDocumentView();
            this.saveState();
        }

        updateDocumentView() {
            this.docSelect.value = this.state.currentDocIndex;
            const currentDoc = this.state.appData.documents[this.state.currentDocIndex];
            this.mainTextArea.textContent = currentDoc.content;
            this.applyRules();
        }
        
        getOriginalText() {
            const tempDiv = document.createElement('div');
            this.mainTextArea.childNodes.forEach(node => {
                if (node.nodeType === Node.TEXT_NODE) {
                    tempDiv.appendChild(node.cloneNode());
                } else if (node.nodeName === 'SPAN' && node.classList.contains('marker')) {
                    tempDiv.appendChild(document.createTextNode(node.dataset.originalText));
                } else if (node.nodeName === 'BR') {
                    tempDiv.appendChild(document.createTextNode('\n'));
                }
            });
            return tempDiv.textContent || '';
        }

        saveState() {
            // ç¾åœ¨ã®æœ¬æ–‡ã‚’ä¿å­˜
            if (this.state.appData.documents[this.state.currentDocIndex]) {
                 this.state.appData.documents[this.state.currentDocIndex].content = this.getOriginalText();
            }
            localStorage.setItem('markerToolState_v2_2', JSON.stringify(this.state.appData));
        }

        loadState() {
            const savedState = localStorage.getItem('markerToolState_v2_2');
            if (savedState) {
                this.state.appData = JSON.parse(savedState);
                // ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®äº’æ›æ€§ãƒã‚§ãƒƒã‚¯
                if (!this.state.appData.documents || !Array.isArray(this.state.appData.documents)) {
                    this.resetData();
                }
            } else {
                this.resetData();
            }
            // Ensure doc count is correct
            while(this.state.appData.documents.length < this.DOC_COUNT) {
                const newIndex = this.state.appData.documents.length + 1;
                this.state.appData.documents.push({ title: `æ–‡ç«  ${newIndex}`, content: `ã“ã‚Œã¯ã€Œæ–‡ç«  ${newIndex}ã€ã§ã™ã€‚` });
            }
            this.state.appData.documents = this.state.appData.documents.slice(0, this.DOC_COUNT);
        }

        resetData() {
            this.state.appData = { documents: [], rules: '' };
            for(let i=1; i<=this.DOC_COUNT; i++) {
                this.state.appData.documents.push({ title: `æ–‡ç«  ${i}`, content: `ã“ã‚Œã¯ã€Œæ–‡ç«  ${i}ã€ã§ã™ã€‚` });
            }
        }
        
        // --- ä»¥ä¸‹ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯v2.1ã‹ã‚‰æµç”¨ã¾ãŸã¯å¾®ä¿®æ­£ ---
        
        handleMarkerClick(e) {
            const marker = e.target.closest('.marker');
            if (!marker) { this.clearAllReveals(); return; }
            const currentTime = new Date().getTime();
            if (currentTime - this.state.lastTap < 500 && this.state.lastClickedMarker === marker) {
                this.removeMarker(marker);
                this.state.lastTap = 0;
            } else {
                this.clearAllReveals(marker);
                this.revealMarker(marker);
                this.state.lastTap = currentTime;
                this.state.lastClickedMarker = marker;
            }
        }
        revealMarker(marker) { marker.classList.add('reveal'); marker.textContent = marker.dataset.originalText; }
        unrevealMarker(marker) {
            marker.classList.remove('reveal');
            const style = marker.dataset.style;
            if (style.startsWith('E')) {
                marker.textContent = style.substring(1).repeat(marker.dataset.originalText.length);
            }
        }
        clearAllReveals(exceptThisOne = null) {
            this.mainTextArea.querySelectorAll('.marker.reveal').forEach(m => {
                if (m !== exceptThisOne) this.unrevealãƒãƒ¼ã‚«ãƒ¼(m);
            });
        }
        removeMarker(marker) { /* ... å …ç‰¢ãªå®Ÿè£…ãŒå¿…è¦ ... */ }
        applyRules() {
            const originalText = this.getOriginalText();
            this.state.appData.documents[this.state.currentDocIndex].content = originalText;
            this.rulesTextArea.value = this.state.appData.rules;
            this.mainTextArea.innerHTML = '';
            
            const allRules = this.state.appData.rules.split('\n').filter(Boolean);
            const targetRules = allRules.filter(line => line.startsWith(this.state.currentDocIndex + ' ::'));

            let segments = [{ text: originalText, type: 'text' }];
            // (v2.1ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’æµç”¨)
            // ...
            
            // ç”»é¢ã¸ã®æç”»
            this.mainTextArea.innerHTML = segments.map(seg => {
                if (seg.type === 'text') {
                    return seg.text.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
                } else {
                    const style = seg.style;
                    const type = style.charAt(0);
                    const value = style.substring(1);
                    let displayContent = '';
                    if (type === 'E') {
                        if (value === 'gray') {
                             displayContent = 'â¬œ'.repeat(seg.text.length);
                        } else {
                             displayContent = value.repeat(seg.text.length);
                        }
                    }
                    return `<span class="marker" data-original-text="${seg.text.replace(/"/g, '&quot;')}" data-style="${style}">${displayContent}</span>`;
                }
            }).join('').replace(/\n/g, '<br>');
            this.saveState();
        }

        toggleRulesPanel() { /* (v2.1ã‹ã‚‰å¤‰æ›´ãªã—) */ }
        initSpeech() { /* (v2.1ã‹ã‚‰å¤‰æ›´ãªã—) */ }
        toggleSpeech() { /* (v2.1ã‹ã‚‰å¤‰æ›´ãªã—) */ }
        clearHighlight() { /* (v2.1ã‹ã‚‰å¤‰æ›´ãªã—) */ }
        highlightText() { /* (v2.1ã‹ã‚‰å¤‰æ›´ãªã—) */ }
    }

    new MarkerToolV2_2();

    // ä»¥ä¸‹ã®éƒ¨åˆ†ã§ã€æœªå®Ÿè£…ã®é–¢æ•°ã‚’ãƒ€ãƒŸãƒ¼ã§å®šç¾©ã—ã¦ã„ã¾ã™
    // å®Ÿéš›ã®å®Ÿè£…ã§ã¯ã€ã“ã‚Œã‚‰ã®é–¢æ•°ã‚’v2.1ã‹ã‚‰ç§»æ¤ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™
    MarkerToolV2_2.prototype.removeMarker = MarkerToolV2_2.prototype.removeMarker || function(marker) { console.log('removeMarker called for', marker.dataset.originalText); /* v2.1ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ã“ã“ã«ç§»æ¤ */};
    MarkerToolV2_2.prototype.toggleRulesPanel = MarkerToolV2_2.prototype.toggleRulesPanel || function() { this.rulesPanel.classList.toggle('closed'); };
    MarkerToolV2_2.prototype.initSpeech = MarkerToolV2_2.prototype.initSpeech || function() {};
    MarkerToolV2_2.prototype.toggleSpeech = MarkerToolV2_2.prototype.toggleSpeech || function() { alert('èª­ã¿ä¸Šã’æ©Ÿèƒ½ã¯ç¾åœ¨é–‹ç™ºä¸­ã§ã™ã€‚'); };
    MarkerToolV2_2.prototype.clearHighlight = MarkerToolV2_2.prototype.clearHighlight || function() {};
    MarkerToolV2_2.prototype.highlightText = MarkerToolV2_2.prototype.highlightText || function() {};

    </script>
</body>
</html>
